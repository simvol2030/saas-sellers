---
/**
 * PostCard Component - карточка статьи для списков
 */
import type { CollectionEntry } from 'astro:content';
import TagList from './TagList.astro';

interface Props {
  post: CollectionEntry<'blog'>;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const { title, description, publishedAt, image, tags, category } = post.data;

const formatDate = (date: Date) => {
  return date.toLocaleDateString('ru-RU', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
};
---

<article class={`post-card ${featured ? 'featured' : ''}`}>
  {image && (
    <a href={`/blog/${post.slug}`} class="post-card-image">
      <img src={image.src} alt={image.alt} loading="lazy" />
    </a>
  )}

  <div class="post-card-content">
    {category && (
      <a href={`/blog/category/${category}`} class="post-card-category">
        {category}
      </a>
    )}

    <h3 class="post-card-title">
      <a href={`/blog/${post.slug}`}>{title}</a>
    </h3>

    {description && (
      <p class="post-card-excerpt">{description}</p>
    )}

    <div class="post-card-footer">
      <time datetime={publishedAt.toISOString()} class="post-card-date">
        {formatDate(publishedAt)}
      </time>

      {tags && tags.length > 0 && (
        <TagList tags={tags.slice(0, 3)} />
      )}
    </div>
  </div>
</article>

<style>
  .post-card {
    display: flex;
    flex-direction: column;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
    transition: all 0.2s;
  }

  .post-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
  }

  .post-card.featured {
    grid-column: span 2;
  }

  @media (max-width: 768px) {
    .post-card.featured {
      grid-column: span 1;
    }
  }

  .post-card-image {
    aspect-ratio: 16/9;
    overflow: hidden;
  }

  .post-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s;
  }

  .post-card:hover .post-card-image img {
    transform: scale(1.05);
  }

  .post-card-content {
    display: flex;
    flex-direction: column;
    flex: 1;
    padding: var(--space-4);
  }

  .post-card-category {
    display: inline-block;
    width: fit-content;
    padding: var(--space-1) var(--space-2);
    background: var(--color-primary);
    color: white;
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: var(--radius-sm);
    margin-bottom: var(--space-2);
    text-decoration: none;
  }

  .post-card-category:hover {
    background: var(--color-primary-dark);
  }

  .post-card-title {
    font-size: 1.25rem;
    font-weight: 600;
    line-height: 1.3;
    margin-bottom: var(--space-2);
  }

  .post-card-title a {
    color: var(--color-text);
    text-decoration: none;
  }

  .post-card-title a:hover {
    color: var(--color-primary);
  }

  .post-card-excerpt {
    color: var(--color-text-muted);
    font-size: 0.875rem;
    line-height: 1.6;
    margin-bottom: var(--space-4);
    flex: 1;

    /* Ограничиваем 3 строками */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-card-footer {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    padding-top: var(--space-3);
    border-top: 1px solid var(--color-border);
  }

  .post-card-date {
    font-size: 0.8125rem;
    color: var(--color-text-muted);
  }

  /* Featured card styles */
  .post-card.featured .post-card-title {
    font-size: 1.5rem;
  }

  .post-card.featured .post-card-excerpt {
    font-size: 1rem;
  }
</style>
