---
/**
 * Footer Component - подвал сайта
 *
 * Features:
 * - Конфигурируемые колонки со ссылками
 * - Социальные сети
 * - Форма подписки на рассылку (опционально)
 * - Responsive grid layout
 * - Интеграция с дизайн-системой
 */

export interface FooterLink {
  label: string;
  href: string;
  external?: boolean;
}

export interface FooterColumn {
  title: string;
  links: FooterLink[];
}

export interface SocialLink {
  name: string;
  href: string;
  icon: 'telegram' | 'vk' | 'youtube' | 'github' | 'twitter' | 'instagram' | 'facebook' | 'linkedin';
}

export interface FooterConfig {
  logo?: {
    text?: string;
    shortText?: string;
    image?: string;
    href?: string;
  };
  description?: string;
  columns?: FooterColumn[];
  socials?: SocialLink[];
  copyright?: string;
  showNewsletter?: boolean;
  newsletterTitle?: string;
  newsletterDescription?: string;
  bottomLinks?: FooterLink[];
}

interface Props {
  config?: FooterConfig;
}

const currentYear = new Date().getFullYear();

// Default configuration
const defaultColumns: FooterColumn[] = [
  {
    title: 'Навигация',
    links: [
      { label: 'Главная', href: '/' },
      { label: 'Блог', href: '/blog' },
      { label: 'О проекте', href: '/about' },
      { label: 'Контакты', href: '/contacts' },
    ],
  },
  {
    title: 'Услуги',
    links: [
      { label: 'Консалтинг', href: '/services/consulting' },
      { label: 'Разработка', href: '/services/development' },
      { label: 'Поддержка', href: '/services/support' },
    ],
  },
  {
    title: 'Правовая информация',
    links: [
      { label: 'Политика конфиденциальности', href: '/privacy' },
      { label: 'Условия использования', href: '/terms' },
      { label: 'Cookies', href: '/cookies' },
    ],
  },
];

const defaultSocials: SocialLink[] = [
  { name: 'Telegram', href: 'https://t.me/', icon: 'telegram' },
  { name: 'VK', href: 'https://vk.com/', icon: 'vk' },
  { name: 'GitHub', href: 'https://github.com/', icon: 'github' },
];

const defaultConfig: FooterConfig = {
  logo: {
    text: 'Content Platform',
    shortText: 'CP',
    href: '/',
  },
  description: 'Универсальная контентная платформа для создания современных веб-сайтов и лендингов.',
  columns: defaultColumns,
  socials: defaultSocials,
  copyright: `© ${currentYear} Content Platform. Все права защищены.`,
  showNewsletter: false,
  newsletterTitle: 'Подпишитесь на рассылку',
  newsletterDescription: 'Получайте новости и обновления',
};

const { config = {} } = Astro.props;
const mergedConfig = { ...defaultConfig, ...config };
const { logo, description, columns, socials, copyright, showNewsletter, newsletterTitle, newsletterDescription, bottomLinks } = mergedConfig;

// Social icons mapping
const socialIcons: Record<string, string> = {
  telegram: '<path d="M22 2 11 13m11-11-5 22-4-9-9-4 22-5Z"/>',
  vk: '<path d="M12.5 2c5.5 0 9.5 4 9.5 9.5S18 21 12.5 21 3 17 3 11.5 7 2 12.5 2m3.5 6h-1.5c-.3 0-.5.2-.5.5v2.5h2l-.3 2h-1.7v5h-2v-5H10v-2h2v-3c0-1.7 1.3-3 3-3h1.5v2Z"/>',
  youtube: '<path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/>',
  github: '<path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/>',
  twitter: '<path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"/>',
  instagram: '<rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/>',
  facebook: '<path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>',
  linkedin: '<path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/>',
};
---

<footer class="footer">
  <div class="footer-container container">
    <!-- Main content -->
    <div class="footer-grid">
      <!-- Brand column -->
      <div class="footer-brand">
        <a href={logo?.href || '/'} class="footer-logo">
          {logo?.image ? (
            <img src={logo.image} alt={logo.text || 'Logo'} class="footer-logo-image" />
          ) : (
            <>
              <span class="footer-logo-icon">{logo?.shortText || 'CP'}</span>
              <span class="footer-logo-text">{logo?.text || 'Content Platform'}</span>
            </>
          )}
        </a>
        {description && <p class="footer-description">{description}</p>}

        <!-- Social links -->
        {socials && socials.length > 0 && (
          <div class="footer-socials">
            {socials.map((social) => (
              <a
                href={social.href}
                class="footer-social-link"
                target="_blank"
                rel="noopener noreferrer"
                aria-label={social.name}
                title={social.name}
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  set:html={socialIcons[social.icon] || ''}
                />
              </a>
            ))}
          </div>
        )}
      </div>

      <!-- Link columns -->
      {columns?.map((column) => (
        <div class="footer-column">
          <h4 class="footer-column-title">{column.title}</h4>
          <ul class="footer-links">
            {column.links.map((link) => (
              <li>
                <a
                  href={link.href}
                  class="footer-link"
                  target={link.external ? '_blank' : undefined}
                  rel={link.external ? 'noopener noreferrer' : undefined}
                >
                  {link.label}
                  {link.external && (
                    <svg class="external-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                      <polyline points="15 3 21 3 21 9"/>
                      <line x1="10" y1="14" x2="21" y2="3"/>
                    </svg>
                  )}
                </a>
              </li>
            ))}
          </ul>
        </div>
      ))}

      <!-- Newsletter -->
      {showNewsletter && (
        <div class="footer-newsletter">
          <h4 class="footer-column-title">{newsletterTitle}</h4>
          {newsletterDescription && <p class="newsletter-description">{newsletterDescription}</p>}
          <form class="newsletter-form" data-newsletter-form>
            <input
              type="email"
              name="email"
              placeholder="Ваш email"
              class="newsletter-input"
              required
            />
            <button type="submit" class="newsletter-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"/>
                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
              </svg>
            </button>
          </form>
        </div>
      )}
    </div>

    <!-- Bottom bar -->
    <div class="footer-bottom">
      <p class="footer-copyright">{copyright}</p>

      {bottomLinks && bottomLinks.length > 0 && (
        <nav class="footer-bottom-nav" aria-label="Дополнительные ссылки">
          {bottomLinks.map((link, index) => (
            <>
              <a
                href={link.href}
                class="footer-bottom-link"
                target={link.external ? '_blank' : undefined}
                rel={link.external ? 'noopener noreferrer' : undefined}
              >
                {link.label}
              </a>
              {index < bottomLinks.length - 1 && <span class="footer-bottom-divider">·</span>}
            </>
          ))}
        </nav>
      )}
    </div>
  </div>
</footer>

<style>
  .footer {
    background: var(--color-background-secondary);
    border-top: 1px solid var(--color-border);
    margin-top: auto;
  }

  .footer-container {
    padding: var(--spacing-16) var(--spacing-4) var(--spacing-8);
  }

  .footer-grid {
    display: grid;
    gap: var(--spacing-10);
    margin-bottom: var(--spacing-10);
  }

  @media (min-width: 640px) {
    .footer-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .footer-grid {
      grid-template-columns: 2fr repeat(3, 1fr);
    }
  }

  /* Brand */
  .footer-brand {
    max-width: 320px;
  }

  .footer-logo {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-3);
    font-weight: var(--font-font-weight-bold);
    font-size: var(--font-font-size-lg);
    color: var(--color-text);
    text-decoration: none;
    margin-bottom: var(--spacing-4);
  }

  .footer-logo:hover {
    color: var(--color-text);
  }

  .footer-logo-image {
    height: 36px;
    width: auto;
  }

  .footer-logo-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: var(--color-primary);
    color: var(--color-text-inverse);
    border-radius: var(--radius-lg);
    font-size: var(--font-font-size-xs);
    font-weight: var(--font-font-weight-bold);
  }

  .footer-description {
    color: var(--color-text-muted);
    font-size: var(--font-font-size-sm);
    line-height: var(--font-line-height-relaxed);
    margin-bottom: var(--spacing-6);
  }

  /* Social Links */
  .footer-socials {
    display: flex;
    gap: var(--spacing-2);
  }

  .footer-social-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    color: var(--color-text-muted);
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    transition: all var(--transition-fast);
  }

  .footer-social-link:hover {
    color: var(--color-primary);
    background: var(--color-primary-light);
  }

  /* Columns */
  .footer-column-title {
    font-size: var(--font-font-size-sm);
    font-weight: var(--font-font-weight-semibold);
    text-transform: uppercase;
    letter-spacing: var(--font-letter-spacing-wide);
    color: var(--color-text);
    margin-bottom: var(--spacing-4);
  }

  .footer-links {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-3);
  }

  .footer-link {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
    color: var(--color-text-secondary);
    font-size: var(--font-font-size-sm);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .footer-link:hover {
    color: var(--color-primary);
  }

  .external-icon {
    opacity: 0.5;
  }

  /* Newsletter */
  .footer-newsletter {
    max-width: 320px;
  }

  .newsletter-description {
    color: var(--color-text-muted);
    font-size: var(--font-font-size-sm);
    margin-bottom: var(--spacing-4);
  }

  .newsletter-form {
    display: flex;
    gap: var(--spacing-2);
  }

  .newsletter-input {
    flex: 1;
    padding: var(--spacing-3) var(--spacing-4);
    font-size: var(--font-font-size-sm);
    color: var(--color-text);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    transition: all var(--transition-fast);
  }

  .newsletter-input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px var(--color-primary-light);
  }

  .newsletter-input::placeholder {
    color: var(--color-text-muted);
  }

  .newsletter-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    background: var(--color-primary);
    color: var(--color-text-inverse);
    border: none;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: background var(--transition-fast);
  }

  .newsletter-btn:hover {
    background: var(--color-primary-hover);
  }

  /* Bottom */
  .footer-bottom {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-4);
    padding-top: var(--spacing-8);
    border-top: 1px solid var(--color-border);
    text-align: center;
  }

  @media (min-width: 768px) {
    .footer-bottom {
      flex-direction: row;
      justify-content: space-between;
      text-align: left;
    }
  }

  .footer-copyright {
    font-size: var(--font-font-size-sm);
    color: var(--color-text-muted);
  }

  .footer-bottom-nav {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    flex-wrap: wrap;
    justify-content: center;
  }

  .footer-bottom-link {
    font-size: var(--font-font-size-sm);
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color var(--transition-fast);
  }

  .footer-bottom-link:hover {
    color: var(--color-primary);
  }

  .footer-bottom-divider {
    color: var(--color-text-muted);
  }
</style>

<script>
  // Newsletter form handling (placeholder)
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('[data-newsletter-form]');
    form?.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(e.target as HTMLFormElement);
      const email = formData.get('email');
      // TODO: Implement actual newsletter subscription
      console.log('Newsletter subscription:', email);
      alert('Спасибо за подписку!');
      (e.target as HTMLFormElement).reset();
    });
  });
</script>
