---
/**
 * Admin Dashboard
 *
 * Overview of content and quick stats
 */
import Admin from '../../layouts/Admin.astro';

export const prerender = false;
---

<Admin title="Dashboard">
  <!-- Auth check script -->
  <script is:inline>
    (function() {
      const accessToken = localStorage.getItem('accessToken');
      if (!accessToken) {
        window.location.href = '/admin/login';
      }
    })();
  </script>

  <div class="dashboard">
    <!-- Stats cards -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üìÑ</div>
        <div class="stat-content">
          <span class="stat-value" id="pages-count">-</span>
          <span class="stat-label">–°—Ç—Ä–∞–Ω–∏—Ü</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">‚úÖ</div>
        <div class="stat-content">
          <span class="stat-value" id="published-count">-</span>
          <span class="stat-label">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üñºÔ∏è</div>
        <div class="stat-content">
          <span class="stat-value" id="media-count">-</span>
          <span class="stat-label">–ú–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">üß±</div>
        <div class="stat-content">
          <span class="stat-value">23</span>
          <span class="stat-label">–°–µ–∫—Ü–∏–π</span>
        </div>
      </div>
    </div>

    <!-- Quick actions -->
    <section class="dashboard-section">
      <h2 class="section-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
      <div class="actions-grid">
        <a href="/admin/pages/new" class="action-card">
          <span class="action-icon">‚ûï</span>
          <span class="action-text">–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</span>
        </a>

        <a href="/admin/media" class="action-card">
          <span class="action-icon">üì§</span>
          <span class="action-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–¥–∏–∞</span>
        </a>

        <a href="/admin/theme" class="action-card">
          <span class="action-icon">üé®</span>
          <span class="action-text">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–º—É</span>
        </a>

        <a href="/" target="_blank" class="action-card">
          <span class="action-icon">üëÅÔ∏è</span>
          <span class="action-text">–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–∞–π—Ç–∞</span>
        </a>
      </div>
    </section>

    <!-- Recent pages -->
    <section class="dashboard-section">
      <div class="section-header">
        <h2 class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h2>
        <a href="/admin/pages" class="section-link">–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí</a>
      </div>
      <div class="recent-list" id="recent-pages">
        <div class="empty-state">
          <p>–°—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
          <a href="/admin/pages/new" class="empty-action">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É</a>
        </div>
      </div>
    </section>

    <!-- Section library preview -->
    <section class="dashboard-section">
      <h2 class="section-title">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ —Å–µ–∫—Ü–∏–π</h2>
      <div class="sections-preview">
        <div class="section-category">
          <h3 class="category-title">–ë–∞–∑–æ–≤—ã–µ (5)</h3>
          <div class="section-tags">
            <span class="section-tag">Hero</span>
            <span class="section-tag">HeroMin</span>
            <span class="section-tag">TextBlock</span>
            <span class="section-tag">Snippet</span>
            <span class="section-tag">CTA</span>
          </div>
        </div>

        <div class="section-category">
          <h3 class="category-title">–ú–µ–¥–∏–∞ (5)</h3>
          <div class="section-tags">
            <span class="section-tag">PhotoGallery</span>
            <span class="section-tag">PhotoSlider</span>
            <span class="section-tag">VideoYouTube</span>
            <span class="section-tag">VideoLocal</span>
            <span class="section-tag">MediaMix</span>
          </div>
        </div>

        <div class="section-category">
          <h3 class="category-title">–ö–æ–Ω–≤–µ—Ä—Å–∏—è (5)</h3>
          <div class="section-tags">
            <span class="section-tag">FAQ</span>
            <span class="section-tag">ContactForm</span>
            <span class="section-tag">Pricing</span>
            <span class="section-tag">CompareTable</span>
            <span class="section-tag">Testimonials</span>
          </div>
        </div>

        <div class="section-category">
          <h3 class="category-title">–ö–æ–Ω—Ç–µ–Ω—Ç (5)</h3>
          <div class="section-tags">
            <span class="section-tag">Features</span>
            <span class="section-tag">Timeline</span>
            <span class="section-tag">Stats</span>
            <span class="section-tag">Team</span>
            <span class="section-tag">Partners</span>
          </div>
        </div>

        <div class="section-category">
          <h3 class="category-title">Social (3)</h3>
          <div class="section-tags">
            <span class="section-tag">InstagramFeed</span>
            <span class="section-tag">FacebookPost</span>
            <span class="section-tag">Longread</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <style>
    .dashboard {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-8);
    }

    /* Stats grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-4);
    }

    .stat-card {
      display: flex;
      align-items: center;
      gap: var(--spacing-4);
      padding: var(--spacing-5);
      background: var(--color-background);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
    }

    .stat-icon {
      font-size: 2rem;
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--color-background-secondary);
      border-radius: var(--radius-md);
    }

    .stat-content {
      display: flex;
      flex-direction: column;
    }

    .stat-value {
      font-size: var(--font-font-size-2xl);
      font-weight: var(--font-font-weight-bold);
      color: var(--color-text);
    }

    .stat-label {
      font-size: var(--font-font-size-sm);
      color: var(--color-text-muted);
    }

    /* Section styles */
    .dashboard-section {
      background: var(--color-background);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-6);
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--spacing-4);
    }

    .section-title {
      margin: 0 0 var(--spacing-4);
      font-size: var(--font-font-size-lg);
      font-weight: var(--font-font-weight-semibold);
      color: var(--color-text);
    }

    .section-header .section-title {
      margin-bottom: 0;
    }

    .section-link {
      color: var(--color-primary);
      text-decoration: none;
      font-size: var(--font-font-size-sm);
    }

    .section-link:hover {
      text-decoration: underline;
    }

    /* Actions grid */
    .actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: var(--spacing-4);
    }

    .action-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-3);
      padding: var(--spacing-5);
      background: var(--color-background-secondary);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      text-decoration: none;
      color: var(--color-text);
      transition: all var(--transition-fast);
    }

    .action-card:hover {
      border-color: var(--color-primary);
      transform: translateY(-2px);
    }

    .action-icon {
      font-size: 1.5rem;
    }

    .action-text {
      font-size: var(--font-font-size-sm);
      font-weight: var(--font-font-weight-medium);
    }

    /* Recent list */
    .recent-list {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-2);
    }

    .empty-state {
      text-align: center;
      padding: var(--spacing-8);
      color: var(--color-text-muted);
    }

    .empty-action {
      display: inline-block;
      margin-top: var(--spacing-3);
      color: var(--color-primary);
      text-decoration: none;
    }

    .empty-action:hover {
      text-decoration: underline;
    }

    /* Sections preview */
    .sections-preview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-4);
    }

    .section-category {
      padding: var(--spacing-4);
      background: var(--color-background-secondary);
      border-radius: var(--radius-md);
    }

    .category-title {
      margin: 0 0 var(--spacing-3);
      font-size: var(--font-font-size-sm);
      font-weight: var(--font-font-weight-semibold);
      color: var(--color-text);
    }

    .section-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-1);
    }

    .section-tag {
      padding: var(--spacing-1) var(--spacing-2);
      background: var(--color-background);
      border-radius: var(--radius-sm);
      font-size: var(--font-font-size-xs);
      color: var(--color-text-secondary);
    }
  </style>

  <script>
    // Load stats
    async function loadStats() {
      const accessToken = localStorage.getItem('accessToken');
      if (!accessToken) return;

      try {
        // Load media count
        const mediaRes = await fetch('/api/media');
        if (mediaRes.ok) {
          const mediaData = await mediaRes.json();
          const mediaCount = document.getElementById('media-count');
          if (mediaCount) {
            mediaCount.textContent = String(mediaData.total || 0);
          }
        }

        // TODO: Load pages count when API is ready
        // For now, show placeholder
        const pagesCount = document.getElementById('pages-count');
        const publishedCount = document.getElementById('published-count');
        if (pagesCount) pagesCount.textContent = '0';
        if (publishedCount) publishedCount.textContent = '0';

      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    loadStats();
  </script>
</Admin>
